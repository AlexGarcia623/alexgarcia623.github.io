<!DOCTYPE html>
<html>
<link rel="stylesheet" href="../ALEX.css">

<meta http-equiv='cache-control' content='no-cache'> 
<meta http-equiv='expires' content='0'> 
<meta http-equiv='pragma' content='no-cache'>

<script src="https://cdn.plot.ly/plotly-2.11.1.min.js"></script>
<script src="plotly-2.11.1.min.js"></script>

<head>
<style>
body {
  background-image:url('Nebula.jpeg');
  background-size:cover;
  background-attachment: fixed; 
  background-size:fill; 
}

* {
  box-sizing:border-box;
}
.column {
  float:left;
  width:50%;
}

.row:after {
  contents: "";
  display: table;
  clear: both;
}

h1, h2 {
  color:red;
}

p, a {
  color:black;
}

img {
  width:85%;
  height:85%;
  border-radius:15px;
}

input {
  background-color:powderblue;
  border: 0.05vw solid darkblue;
  border-radius:16px;
  color:darkblue;
  padding:0.5vw;
  font-size:min(max(14pt, 2vw), 20pt);
}

input:hover {
  transition:0.5s;
  transform:scale(1.005);
  background-color:darkblue;
  color:powderblue;
  margin-left:0px;
  margin-right:0px;
}

input:not(:hover) {
  transition:0.5s;
  transform:scale(1);
  border: 0.05vw solid darkblue;
  color:darkblue;
}

.constellations {
   width:100%;
   height:100%;
   position: relative;
   display: inline-block;
}

.constellations .img-top {
  display: none;
  width:85%;
  height:99.3%;  
  position: absolute;
  top:0;
  left:0;
}
.constellations:hover .img-top {
    display: inline-block;
}

.HubbleConstant {
  border: 1vw solid red;
  background-color:#ffa07a;
  border-radius:5px;
  padding:25px;
  margin-top:10px;
  margin-bottom:10px;
  max-width:120ch;
}

footer {
  margin-top:15px;
  padding-bottom:0px;
}

body > footer {
  display: table-row;
}

.footerButton {
  margin-bottom:0;
}

canvas {
  border:5px black solid;
  background-color:white;
  border-radius:15px;
  width:75%;
}

button {
  background-color:darkgray;
  border:2px black solid;
  border-radius:5px;
  font-size:min(max(10pt, 2vw), 14pt);
  position:absolute;
  padding:2.5px;
}

button:hover {
  background-color:white;
  cursor:pointer;
}

input {
  position:absolute;
  width:50%;
  background-color:darkgray;
  border: 2px black solid;
  border-radius:16px;
  color:black;
  padding:0.5vw;
  font-size:min(max(10pt, 2vw), 14pt);
  transition:0s;
}

input:hover {
  background-color:white;
  color:black;
  border: 2px black solid;
}

input:not(:hover) {
  border: 2px black solid;
  color:black;
}

input::placeholder {
  color:black;
}

.loading {
  position: relative;
}

.loading:before {
  content:'';
  animation: load var(--seconds) linear;
}

@keyframes load{
  0%{content:  'STARTING';}
  5%{content:  'Generating Spectrum.';}
  7.5%{content:  'Generating Spectrum..';}
  10%{content: 'Generating Spectrum...';}
  12.5%{content: 'Generating Spectrum';}
  15%{content: 'Generating Spectrum.';}
  17.5%{content: 'Generating Spectrum..';}
  20%{content: 'Generating Spectrum...';}
  22.5%{content: 'Generating Spectrum';}
  25%{content: 'Generating Spectrum.';}
  27.5%{content: 'Generating Spectrum..';}
  30%{content: 'Generating Spectrum...';}
  32.5%{content: 'Generating Spectrum';}
  35%{content: 'Generating Spectrum.';}
  37.5%{content: 'Generating Spectrum..';}
  40%{content: 'Generating Spectrum...';}
  42.5%{content: 'Generating Spectrum';}
  45%{content: 'Generating Spectrum.';}
  47.5%{content: 'Generating Spectrum..';}
  50%{content: 'Generating Spectrum...';}
  52.5%{content: 'Generating Spectrum';}
  55%{content: 'Generating Spectrum.';}
  57.5%{content: 'Generating Spectrum..';}
  60%{content: 'Generating Spectrum...';}
  62.5%{content: 'Generating Spectrum';}
  65%{content: 'Generating Spectrum.';}
  67.5%{content: 'Generating Spectrum..';}
  70%{content: 'Generating Spectrum...';}
  72.5%{content: 'Generating Spectrum';}
  75%{content: 'Generating Spectrum.';}
  77.5%{content: 'Generating Spectrum..';}
  80%{content: 'Generating Spectrum...';}
  82.5%{content: 'Generating Spectrum';}
  85%{content: 'Generating Spectrum.';}
  87.5%{content: 'Generating Spectrum..';}
  90%{content: 'Generating Spectrum...';}
  92.5%{content: 'Generating Spectrum';}
  95%{content: 'Generating Spectrum.';}
  97.5%{content: 'Generating Spectrum..';}
}

/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow-y: hidden; 
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  background-color: #ffa07a;
  border-radius:5px;
  margin: auto;
  padding: 20px;
  border: 1vw solid red;
  width: 80%;
}

</style>

<script>
function backButton() {
  window.open("../ALEXLabs.html","_self");
}
</script>

</head>

<header>
  <title>Hubble Constant </title>
  <button class = "button biggerButton" onclick="backButton()">ALEX Home</button>
</header>

<body>
<div class="body">

  <div class="HubbleConstant center" style="min-width:110ch;">

    <h2 style="text-align:center;font-size:35pt;">Measuring the Hubble Constant</h2>

  </div>
 


  <div class="center" style="position:relative;min-width:110ch;">

    <canvas id="canvas" height="500" width="750" class="center"></canvas>  

    <button onclick="east()" style="left:20%;top:25%;width:3%;">E</button> 
    <button onclick="west()" style="left:25%;top:25%;width:3%;">W</button>
    <button onclick="north()" style="left:22.5%;top:20%;width:3%;">N</button>
    <button onclick="south()" style="left:22.5%;top:30%;width:3%;">S</button>

    <button onclick="changeIncrement()" style="left:19%;top:45%;width:10%;background-color:darkgray;" id="changeSlew">Change Slew Rate</button>
    <button onclick="inc(20)" style="left:20%;top:55%;width:8%;display:none;" id='bigInc'>Rapid</button>
    <button onclick="inc(5)" style="left:20%;top:60%;width:8%;display:none;" id='smallInc'>Nominal</button>
    <button onclick="inc(1)" style="left:20%;top:65%;width:8%;display:none;" id='tinyInc'>Slow</button>

    <button onclick="showAll()" style="left:70.75%;top:30%;width:12%;background-color:darkgray;" id="changeField">Change Field</button>

    <button onclick="switchImage('test1')" style="left:71.75%;top:37.5%;width:10%;display:none;" id="Field1">Perseus</button>
    <button onclick="switchImage('test2')" style="left:71.75%;top:45%;width:10%;display:none;" id="Field2">Ursa Minor</button>
    <button onclick="switchImage('test3')" style="left:71.75%;top:52.5%;width:10%;display:none;" id="Field3">Field 3</button>
    <button onclick="switchImage('test4')" style="left:71.75%;top:60%;width:10%;display:none;" id="Field4">Field 4</button>
    <button onclick="switchImage('test5')" style="left:71.75%;top:67.5%;width:10%;display:none;" id="Field5">Field 5</button>

    <button onclick="zoomIn()" style="left:20%;top:77.5%;width:8%;display:none;" id="zoomIn">Zoom In </button>
    <button onclick="zoomOut()" style="left:20%;top:77.5%;width:8%;display:none;" id="zoomOut">Zoom Out </button>
    <button onclick="buttonPress()" style="left:20%;top:87.5%;width:8%;display:none;" id="takeSpectrum">Take Spectrum </button>

    <button onclick="animateDoorsOpen()" style="left:40%;top:87.5%;width:8%;background-color:lightgreen;">Open Dome</button>
    <button onclick="animateDoorsClose()" style="left:50%;top:87.5%;width:8%;background-color:coral;">Close Dome</button>

    <button onclick="intToggle()" style="left:70.75%;top:5%;width:12%;background-color:darkgray;" id="intToggleButton">Change Integration Time </button>

    <input id="intTime" type = "number" class="inputText" placeholder="Enter Time" min="1" max="1000" oninput=addNoise() onchange=addNoise() style="left:70.75%;top:17.5%;width:12%;display:none;"/>

  </div>

  <div class="modal" id="myModal">
    <div class="modal-content">
      <p id="loading"></p>
      <p id="SpectrumDone"></p>

	<p>The apparent magnitude of <span id="galaxyName"></span> is: <span id="appMag"></span> </p>

      <div id="myPlot" style="width:100%;padding-left:0;padding-right:0%;"></div>
      <p>Click anywhere outside this box to exit</p>
      <p id = "clickLocation"></p>
    </div>
  </div>

  <div class="HubbleConstant center">
    <p id='domeWarning' style="color:black;"> </p>
    <p id='test'> </p>

    <p>What else needs to be added?<br><br> Fields 3, 4, and 5 <br> Noise based on how far away you select from the center of the galaxy <br> Allow arrow keys to move the image?</p>
  </div>

  <div class="HubbleConstant center" style="display:none;">

    <h2>NGC 1260 (Lenticular Galaxy) -- Perseus</h2>

    <div class="constellations">
      <img src="./Galaxies/zoomNGC1260.png" id = "test1"/>
      <img src="./Galaxies/NGC_1260.png" id = "NGC1260"/>
    </div>

  </div>
  
  <div class="HubbleConstant center" style="display:none;">

    <h2>NGC 5452 -- Ursa Minor </h2>

    <div class="constellations">
      <img src="./Galaxies/zoomNGC5452.png" id = "test2"/>
      <img src="./Galaxies/NGC_5452.jpeg" id = "NGC5452"/>
    </div>

  </div>

  <div class="HubbleConstant center" style="display:block;">

    <h2>Corona Borealis Supercluser -- Corona Borealis -- I need to change this</h2>

    <div class="constellations">
      <img src="./Galaxies/CoronaBorealis2.png" usemap="#locationsMap"  id = "test3"/>
    </div>

  </div>

  <p style="color: #ffa07a;">All sky images taken from <a href="https://stellarium-web.org/" style="color: #ffa07a" target="_blank">Stellarium</a></p>

<script>

function backgroundImage() {
  window.open("backgroundExplain.html",target="_self");
}

//
// Virtual Observatory
//

var xpos = 60;
var ypos = 80;

var imgWidth  = 300;
var imgHeight = 233;

var increment = 20;

var imgName = 'test1';
var image = document.getElementById('test1');

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext('2d');

var bigInc   = document.getElementById('bigInc');
bigInc.style.backgroundColor = 'white';

// Extent of the galaxies on the image: xmin, xmax, ymin, ymax
var allGalExtent = {
  "Perseus": [328, 341, 158, 180],
  "UrsaMinor": [245, 315, 50, 93],
  "Field3": [],
  "Field4": [],
  "Field5": []
};

var whichZoomIn = {
  "Perseus": "NGC1260",
  "UrsaMinor": "NGC5452",
  "Field3": "test3",
  "Field4": "test4",
  "Field5": "test5"
}

var whichZoomOut = {
  "Perseus": "test1",
  "UrsaMinor": "test2",
  "Field3": "test3",
  "Field4": "test4",
  "Field5": "test5"
}

var currentField = "Perseus";

function inc(newIncrement) {
  increment = parseInt(newIncrement);
  var bigInc   = document.getElementById('bigInc');
  var smallInc = document.getElementById('smallInc');
  var tinyInc  = document.getElementById('tinyInc');

  if (increment == 20) {
    bigInc.style.backgroundColor = 'white';
    smallInc.style.backgroundColor = 'darkgray';
    tinyInc.style.backgroundColor = 'darkgray';
  } else if (increment == 5) {
    bigInc.style.backgroundColor = 'darkgray';
    smallInc.style.backgroundColor = 'white';
    tinyInc.style.backgroundColor = 'darkgray';
  } else if (increment == 1) {
    bigInc.style.backgroundColor = 'darkgray';
    smallInc.style.backgroundColor = 'darkgray';
    tinyInc.style.backgroundColor = 'white';
  }
}

function changeIncrement() {
  var bigInc   = document.getElementById('bigInc');
  var smallInc = document.getElementById('smallInc');
  var tinyInc  = document.getElementById('tinyInc');

  var changeSlewButton = document.getElementById("changeSlew");

  if (changeSlewButton.style.backgroundColor === 'darkgray') {
    changeSlewButton.style.backgroundColor = 'white';
  } else {
    changeSlewButton.style.backgroundColor = 'darkgray';
  } 

  bigInc.style.display   = bigInc.style.display != 'none'? 'none' : 'block';
  smallInc.style.display = smallInc.style.display != 'none'? 'none' : 'block';
  tinyInc.style.display  = tinyInc.style.display != 'none'? 'none' : 'block';
}

function intToggle() {
  var intInput = document.getElementById("intTime");
  intInput.style.display = intInput.style.display != 'none' ? 'none' : 'block';

  var intToggleButton = document.getElementById("intToggleButton");

  if (intToggleButton.style.backgroundColor === 'darkgray') {
    intToggleButton.style.backgroundColor = 'white';
  } else {
    intToggleButton.style.backgroundColor = 'darkgray';
  }
}

function showZoom() {
  var extent = allGalExtent[currentField];
  var xmin = extent[0];
  var xmax = extent[1];
  var ymin = extent[2];
  var ymax = extent[3];
  if ((xpos > xmin) && (xpos < xmax) && (ypos > ymin) && (ypos < ymax)) {
    document.getElementById("zoomIn").style.display  = "block";
  }
}

function zoomIn() {
  if (move) {
    which = whichZoomIn[currentField];
    image = document.getElementById(which);
    telescopeFrame();
    document.getElementById("zoomOut").style.display = "block";
    document.getElementById("zoomIn").style.display  = "none";
    document.getElementById("takeSpectrum").style.display = "block";
  }
}

function zoomOut() {
  if (move) {
    which = whichZoomOut[currentField];
    image = document.getElementById(which);
    telescopeFrame();
    document.getElementById("zoomOut").style.display = "none";
    document.getElementById("zoomIn").style.display  = "block";
    document.getElementById("takeSpectrum").style.display = "none";
  }
}

var move = false;

var domeLocLeft  = 375; // location of center of doors -- starts closed at 375
var domeLocRight = 375;
var width = 125;

var changeAnimation = 5;

function closedDome() {

  ctx.fillStyle = 'gray';
  ctx.fillRect(0, 0, 200, 500);
  ctx.fillRect(550, 0, 200, 500);

  ctx.fillStyle = 'darkgray';
  ctx.fillRect(200, 0, 350, 500);

  ctx.strokeStyle = 'black';
  ctx.linewidth = 10;
  ctx.moveTo(200, 0);
  ctx.lineTo(200, 500);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(550, 0);
  ctx.lineTo(550, 500);
  ctx.stroke();

  // dome doors
  
  ctx.strokeRect(250, 50, 125, 350);
  ctx.strokeRect(375, 50, 125, 350);

  ctx.strokeStyle = 'darkgray';
  ctx.beginPath(); 
  ctx.moveTo(375, 50);
  ctx.lineTo(375, 400);
  ctx.stroke();

}

function openDome() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = 'gray';
  ctx.fillRect(0, 0, 200, 500);
  ctx.fillRect(550, 0, 200, 500);

  ctx.fillStyle = 'darkgray';
  ctx.fillRect(200, 0, 350, 500);
  
  ctx.strokeStyle = 'black';
  ctx.linewidth = 10;
  ctx.moveTo(200, 0);
  ctx.lineTo(200, 500);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(550, 0);
  ctx.lineTo(550, 500);
  ctx.stroke();

  ctx.fillStyle = 'black';
  ctx.fillRect(250, 50, 250, 350);

  ctx.drawImage(image, xpos, ypos, imgWidth, imgHeight, 250, 50, 250, 350);

  if (domeLocLeft < 250) {
    window.clearInterval(interval_tracker);
    ctx.fillStyle = 'black';
    ctx.fillRect(250, 50, 250, 350);
    telescopeFrame();
    move = true;
  }

  domeLocLeft  = domeLocLeft - changeAnimation;
  domeLocRight = domeLocRight + changeAnimation;
  width = width - changeAnimation;
 
  // dome doors
  ctx.strokeRect(250, 50, 250, 350);  
  ctx.fillStyle="darkgray";
  ctx.fillRect(domeLocLeft , 50, -width, 350);
  ctx.fillRect(domeLocRight, 50, width, 350);

  ctx.strokeStyle = 'darkgray';
  ctx.beginPath(); 
  ctx.moveTo(domeLocLeft, 50);
  ctx.lineTo(domeLocLeft, 400);
  ctx.stroke();
  ctx.beginPath(); 
  ctx.moveTo(domeLocRight, 50);
  ctx.lineTo(domeLocRight, 400);
  ctx.stroke();
}

function closeDome() {
  move = false;
  document.getElementById("zoomIn").style.display = "none";
  document.getElementById("zoomOut").style.display = "none";
  document.getElementById("takeSpectrum").style.display = "none";
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = 'gray';
  ctx.fillRect(0, 0, 200, 500);
  ctx.fillRect(550, 0, 200, 500);

  ctx.fillStyle = 'darkgray';
  ctx.fillRect(200, 0, 350, 500);
  
  ctx.strokeStyle = 'black';
  ctx.linewidth = 10;
  ctx.moveTo(200, 0);
  ctx.lineTo(200, 500);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(550, 0);
  ctx.lineTo(550, 500);
  ctx.stroke();

  ctx.fillStyle = 'black';
  ctx.fillRect(250, 50, 250, 350);

  ctx.drawImage(image, xpos, ypos, imgWidth, imgHeight, 250, 50, 250, 350);

  if (domeLocLeft > 375 - changeAnimation) {
    window.clearInterval(interval_tracker);
    ctx.fillStyle = 'black';
    ctx.linewidth = 10;
    ctx.fillRect(250, 50, 250, 350);    
    ctx.beginPath();
    ctx.strokeStyle = 'black';
    ctx.moveTo(375,50);
    ctx.lineTo(375,400);
    ctx.stroke();
  }

  domeLocLeft  = domeLocLeft + changeAnimation;
  domeLocRight = domeLocRight - changeAnimation;
  width = width + changeAnimation;
 
  // dome doors
  ctx.strokeRect(250, 50, 250, 350);  
  ctx.fillStyle="darkgray";
  ctx.fillRect(domeLocLeft , 50, -width, 350);
  ctx.fillRect(domeLocRight, 50, width, 350);

  ctx.strokeStyle = 'darkgray';
  ctx.beginPath(); 
  ctx.moveTo(domeLocLeft, 50);
  ctx.lineTo(domeLocLeft, 400);
  ctx.stroke();
  ctx.beginPath(); 
  ctx.moveTo(domeLocRight, 50);
  ctx.lineTo(domeLocRight, 400);
  ctx.stroke();

  ctx.beginPath();
  ctx.strokeStyle = 'black';
  ctx.moveTo(domeLocLeft,50);
  ctx.lineTo(domeLocLeft,400);
  ctx.stroke();
}


var interval_tracker = "";

var fps = 10;

function animateDoorsOpen() {
  interval_tracker = setInterval(function(){ //throttle requestAnimationFrame to 20fps
       requestAnimationFrame(openDome);
  }, 1000/fps)
}

function animateDoorsClose() {
  interval_tracker = setInterval(function(){ //throttle requestAnimationFrame to 20fps
       requestAnimationFrame(closeDome);
  }, 1000/fps)
}

function telescopeFrame() {
  showZoom();
  ctx.fillStyle = 'gray';
  ctx.fillRect(0, 0, 200, 500);
  ctx.fillRect(550, 0, 200, 500);

  ctx.fillStyle = 'darkgray';
  ctx.fillRect(200, 0, 350, 500);
  
  ctx.strokeStyle = 'black';
  ctx.linewidth = 10;
  ctx.moveTo(200, 0);
  ctx.lineTo(200, 500);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(550, 0);
  ctx.lineTo(550, 500);
  ctx.stroke();

  ctx.fillStyle = 'black';
  ctx.fillRect(250, 50, 250, 350);

  ctx.drawImage(image, xpos, ypos, imgWidth, imgHeight, 250, 50, 250, 350);

  ctx.strokeRect(250, 50, 250, 350);

  ctx.beginPath();
  ctx.strokeStyle = 'red';

  var topSpec    = 200;
  var bottomSpec = 230;

  ctx.moveTo(370, topSpec);
  ctx.lineTo(370, bottomSpec);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(380, topSpec);
  ctx.lineTo(380, bottomSpec);
  ctx.stroke();
}

function west() {
  if (move) {
    if (xpos + increment < image.width - imgWidth) {
      xpos = xpos + increment;
      telescopeFrame();
    }
  }
  document.getElementById('test').innerHTML = xpos + ' ' + ypos;
}

function east() {
  if (move) {
    if (xpos - increment > 0) {
      xpos = xpos - increment;
      telescopeFrame();
    }
  }
  document.getElementById('test').innerHTML = xpos + ' ' + ypos;
}

function north() {
  if (move) {
    if (ypos - increment > 0) {
      ypos = ypos - increment;
      telescopeFrame();
    }
  }
  document.getElementById('test').innerHTML = xpos + ' ' + ypos;
}

function south() {
  if (move) {
    if (ypos + increment < image.height - imgHeight) {
      ypos = ypos + increment;
      telescopeFrame();
    }
  }
  document.getElementById('test').innerHTML = xpos + ' ' + ypos;
}

function showAll() {
  var changeFieldButton = document.getElementById("changeField")

  if (changeFieldButton.style.backgroundColor === 'darkgray') {
    changeFieldButton.style.backgroundColor = 'white';
  } else {
    changeFieldButton.style.backgroundColor = 'darkgray';
  }

  field1 = document.getElementById("Field1");
  field1.style.display = field1.style.display != 'none'? 'none' : 'block';
  
  field2 = document.getElementById("Field2");
  field2.style.display = field2.style.display != 'none'? 'none' : 'block';
  
  field3 = document.getElementById("Field3");
  field3.style.display = field3.style.display != 'none'? 'none' : 'block';

  field4 = document.getElementById("Field4");
  field4.style.display = field4.style.display != 'none'? 'none' : 'block';

  field5 = document.getElementById("Field5");
  field5.style.display = field5.style.display != 'none'? 'none' : 'block';
}

var whichIsWhich = {
  "test1":"Perseus",
  "test2":"UrsaMinor",
  "test3":"Field3",
  "test4":"Field4",
  "test5":"Field5"
};

var colorHelper = {
  "test1":"Field1",
  "test2":"Field2",
  "test3":"Field3",
  "test4":"Field4",
  "test5":"Field5"
}

var cHelp = colorHelper[imgName];
document.getElementById(cHelp).style.backgroundColor = 'white';

function switchImage(which2switch) {
  if (!move) {
    image = document.getElementById(which2switch);
  
    currentField = whichIsWhich[which2switch];
    TRUE_REDSHIFT = TRUE_REDSHIFTS[currentField];
    APP_MAG       = APP_MAGS[currentField];
    DIST          = DISTS[currentField];

    CALCIUM_H_REDSHIFTED = CALCIUM_H + CALCIUM_H * TRUE_REDSHIFT;
    CALCIUM_K_REDSHIFTED = CALCIUM_K + CALCIUM_K * TRUE_REDSHIFT;

    document.getElementById("appMag").innerHTML = APP_MAG;
    document.getElementById("galaxyName").innerHTML = whichZoomIn[currentField];

    imgName = which2switch;
    xpos = 60;
    ypox = 40;
    document.getElementById('domeWarning').innerHTML = '';

    cHelp = colorHelper[which2switch]

    document.getElementById(cHelp).style.backgroundColor = 'white';    

    keys = Object.keys(colorHelper);
    for (var i = 0; i < keys.length; ++i) {
      if (keys[i] != which2switch) {
        document.getElementById(colorHelper[keys[i]]).style.backgroundColor = 'darkgray';
      }
    }

  } else {
    document.getElementById('domeWarning').innerHTML = 'You must close the dome before you can change fields';
  }
  //telescopeFrame();
}

//telescopeFrame();
closedDome();
//openDome();

var lambdaArr = new Array(1000);
var fluxArr   = new Array(1000);

var noise = 1;

var docStyle = document.documentElement.style;
docStyle.setProperty("--seconds", String(noise)+"s");

function addNoise() {
  noise = parseInt(document.getElementById("intTime").value);
}

var CALCIUM_H = 3969;
var CALCIUM_K = 3934;

var APP_MAGS = {
  "Perseus":14.3,
  "UrsaMinor":13.2
};
var DISTS   = {
  "Perseus":76.7,
  "UrsaMinor":33.0,
}; //Mpc

// Center of galaxy: xcenter, ycenter, rough extent
var CLICK_FROM_CENTER = 1;
//{  
//  "Perseus": [150, 238, 30],
//  "UrsaMinor": [224, 270, 200]
// };

var TRUE_REDSHIFTS = {
  "Perseus":0.01919,
  "UrsaMinor":0.006891
} 

var TRUE_REDSHIFT = TRUE_REDSHIFTS[currentField];
var APP_MAG       = APP_MAGS[currentField];
var DIST          = DISTS[currentField];

var CALCIUM_H_REDSHIFTED = CALCIUM_H + CALCIUM_H * TRUE_REDSHIFT;
var CALCIUM_K_REDSHIFTED = CALCIUM_K + CALCIUM_K * TRUE_REDSHIFT;

function random(min, max) {
  return Math.random() * (max - min) + min;
}

function generateGaussian(mean,std){
  var _2PI = Math.PI * 2;
  var u1 = Math.random();
  var u2 = Math.random();
  
  var z0 = Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(_2PI * u2);
  var z1 = Math.sqrt(-2.0 * Math.log(u1)) * Math.sin(_2PI * u2);

  return z1 * std + mean;
}

for (var i = 3900; i < 4901; ++i) {
  lambdaArr[i-3000] = i;
}

trace1 = {x:lambdaArr,y:fluxArr};

data = [trace1];

var layout= {
  plot_bgcolor:"black",
  paper_bgcolor:"black",
  yaxis: {
    autorange: true,
    showgrid: false,
    zeroline: false,
    showline: false,
    autotick: true,
    ticks: '',
    showticklabels: false
  },
  xaxis: {
    tickcolor: "white",
    tickfont: {color:"white"}
  },
  showlegend:false
}

var config = {
  modeBarButtonsToRemove:['pan2d','lasso2d','select2d','autoScale2d','toImage','zoom2d','resetScale2d','zoomIn2d','zoomOut2d'],
  responsive:true,
  displaylogo:false
}

var done = false;
var loader = document.getElementById("loading");
var modal = document.getElementById("myModal");

function updateDisplay() {
  docStyle.setProperty("--seconds", String(noise/2)+"s");
  if (done) {
    done = false;
    loader.classList.remove('loading');
    //setTimeout(() => fill.classList.add('loading'), 1);
  }
}

function buttonPress() {
  modal.style.display = "block";
  loader.classList.add("loading");
  document.getElementById("SpectrumDone").innerHTML = "";
  Plotly.newPlot("myPlot", [], layout, config)
  loader.onclick = updateDisplay();
  loader.addEventListener("animationend", function() {
    generateSpectrum();
    done = true;
    updateDisplay();
  });
}

function generateSpectrum() {
  for (var i = 3900; i < 4901; ++i) {
    lambdaArr[i-3000] = i;
    fluxArr[i-3000] = i/4900 - generateGaussian(1/5,1/7)/Math.sqrt(noise);
  }

  for (var i = 0; i < 3000*Math.sqrt(noise); ++i) {
    var index = lambdaArr.indexOf(Math.round(generateGaussian(CALCIUM_H_REDSHIFTED,4)));  
    fluxArr[index] = fluxArr[index] - 0.0001*CLICK_FROM_CENTER;
    var index = lambdaArr.indexOf(Math.round(generateGaussian(CALCIUM_K_REDSHIFTED,4)));  
    fluxArr[index] = fluxArr[index] - 0.0001*CLICK_FROM_CENTER;
  }
  trace1 = {x:lambdaArr,y:fluxArr,marker:{color:'rgb(219, 64, 82)'}};

  data = [trace1];
  Plotly.newPlot("myPlot", data, layout, config);
  if (noise == 1) {
    var seconds = "second";
  } else {
    var seconds = "seconds";
  }
  document.getElementById("SpectrumDone").innerHTML = "Spectrum Complete (below), integration time: " + String(noise) + " " + String(seconds);
}

function sleep(milliseconds) {
  const date = Date.now();
  let currentDate = null;
  do {
    currentDate = Date.now();
  } while (currentDate - date < milliseconds);
}

window.onclick = function(event) {
 if (event.target == modal) {
    modal.style.display = "none"
  }
}

Plotly.newPlot("myPlot", data, layout, config)

</script>
<footer>
  <button class="button" onclick="backgroundImage()">About the background image </button>
</footer>

</body>

</html>
