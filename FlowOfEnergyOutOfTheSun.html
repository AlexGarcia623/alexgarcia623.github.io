<!DOCTYPE html>
<html>
<link rel="stylesheet" href="style.css">

<meta http-equiv='cache-control' content='no-cache'> 
<meta http-equiv='expires' content='0'> 
<meta http-equiv='pragma' content='no-cache'>

<script src="scripts.js"></script>

<head>
<style>
* {
  box-sizing:border-box;
}
.column {
  float:left;
  width:50%;
}

.row:after {
  contents: "";
  display: table;
  clear: both;
}

p {
  color:steelblue;
  font-size:14pt;
}

h1 {
  font-size:30pt;
}

h2 {
  font-size:18pt;
}

button {
  background-color:black;
  color:steelblue;
  border: 1px solid tomato;
  padding: 8px;
  font-size: 12pt;
}

button:hover {
  background-color:steelblue;
  color:black;
}

input:hover {
  background-color:steelblue;
  color:black;
}

.column3 {
  float:left;
  width:33%;
}

img:hover {
  width=110%;
}
#canvas {
  border: 1px solid black;
}

</style>

<script src="https://cdn.plot.ly/plotly-2.11.1.min.js"></script>
<script src="plotly-2.11.1.min.js"></script>

</head>

<header>
  <title>Spectroscopy II</title>
  <button class = "button biggerButton" onclick="SpecHome()">Main Menu</button>
</header>

<script>
  function SpecHome() {
    window.open('AstronomicalSpectroscopyII.html','_self');
  }
</script>

<body>
<form name = "converter">
<div class="body">

   <h1>Flow Of Energy Out Of The Sun: Blackbody and Continuous Spectrum </h2> 

  <p style="color:white;">Welcome to the flow of energy out of the sun! This first experiment is to understand the random walk through the Sun as well as blackbody emission.</p>

  <canvas class="center" id="canvas" height="500" width="750"></canvas> <br>
  <input type="button" onclick="start()" value="Start!" class="center"/>
  <h2>Number of walks:</h2>
  <p id="display"> </p>
  <p style="font-size:25pt;"><span id="finish" style="color:orange;"></span> <span id='WL'> </span></p>

  <input type="button" onclick="FandP()" value="Finish and Plot" class="center"/>

</form>


</body>

<script>
    // Based on code found here: https://gist.github.com/hacknightly/fd609abe5a7e15e223a823ee6e0724c8
    let x = 375;
    let y = 250;
    var counter = document.querySelector('canvas');
    var number = 0;
    var animation = false;

    function FandP() {
      window.open('finishAndPlot.html','_self');
    }

    function random(min, max) {
      return Math.random() * (max - min) + min;
    }

    function init() {
      animation = window.requestAnimationFrame(draw);
    }

    function draw() {
      number++;
      counter.textContext = number;
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');    

      const disp = document.getElementById('display');
      document.getElementById("display").innerHTML = number;

      //ctx.strokeStyle = 'yellow';
      //ctx.beginPath();
      //ctx.arc(375, 250, 200, 0, 2 * Math.PI);
      //ctx.lineWidth = 3;
      //ctx.stroke();
      ctx.beginPath();
      ctx.strokeStyle = 'red';
      ctx.arc(375, 250, 15, 0, 2 * Math.PI);
      ctx.stroke();
      ctx.beginPath();
      ctx.strokeStyle = 'orange';
      ctx.arc(375, 250, 150, 0, 2 * Math.PI);
      ctx.stroke();

      var wavelength = normalRandomScaled(550, 150);
      var color = wavelengthToColor(wavelength);

      ctx.strokeStyle = color;
      ctx.beginPath();
      ctx.moveTo(x, y);
      if ( ((x-375)**2 + (y-250)**2)**(1/2) < 15 ) {
        pertx = random(-2.5, 2.5);
        perty = random(-2.5, 2.5);
      } else if ( ((x-375)**2 + (y-250)**2)**(1/2) < 150 ) {
        pertx = random(-10, 10);
        perty = random(-10, 10);
      } //else {
        //pertx = random(-10, 10);
        //perty = random(-10, 10);
      //}
      ctx.lineWidth = 2;
      ctx.lineTo(x+pertx, y+perty);
      ctx.stroke();

      x += pertx;
      y += perty;
      if ( ((x-375)**2 + (y-250)**2)**(1/2) > 150 ) {
        document.getElementById("display").innerHTML = number;
        document.getElementById("finish").innerHTML = "The photon entered the atmosphere with wavelength:";
        document.getElementById("WL").innerHTML = String(wavelength) + " nm";
        document.getElementById("WL").style.color = color;
        
      }
      else {
        animation = window.requestAnimationFrame(draw);
      }
    }
    
    function start() {
        	if (animation) {
  	  window.cancelAnimationFrame(animation)
	}
	const canvas = document.getElementById('canvas');
	const context = canvas.getContext('2d');

	context.clearRect(0, 0, canvas.width, canvas.height);

         x = 375;
         y = 250;
         number = 0;
         document.getElementById("display").innerHTML = 0;
         document.getElementById("finish").innerHTML = "";
         document.getElementById("WL").innerHTML = "";
	init();
    }
 
    var spareRandom = null;
    // Generate Random Variable: https://gist.github.com/bluesmoon/7925696
    function normalRandom() {
	var val, u, v, s, mul;

	if(spareRandom !== null) {
		val = spareRandom;
		spareRandom = null;
	} else {
		do {
			u = Math.random()*2-1;
			v = Math.random()*2-1;

			s = u*u+v*v;
		} while(s === 0 || s >= 1);

		mul = Math.sqrt(-2 * Math.log(s) / s);

		val = u * mul;
		spareRandom = v * mul;
	}	
	return val;
    }

    function normalRandomScaled(mean, stddev) {
	var r = normalRandom();
	r = r * stddev + mean;
        	if (r < 350) { r = normalRandomScaled(mean, stddev) } 
        	else if (r > 700) { r = normalRandomScaled(mean, stddev) }
	return parseInt(r);
    }
   
    // takes wavelength in nm and returns an rgba value
    // Taken from: https://scienceprimer.com/javascript-code-convert-light-wavelength-color
    function wavelengthToColor(wavelength) {
        var r,
            g,
            b,
            alpha,
            colorSpace,
            wl = wavelength,
            gamma = 1;
 
 
        if (wl >= 350 && wl < 440) {
            R = -1 * (wl - 440) / (440 - 350);
            G = 0;
            B = 1;
       } else if (wl >= 440 && wl < 490) {
           R = 0;
           G = (wl - 440) / (490 - 440);
           B = 1;  
        } else if (wl >= 490 && wl < 510) {
            R = 0;
            G = 1;
            B = -1 * (wl - 510) / (510 - 490);
        } else if (wl >= 510 && wl < 580) {
            R = (wl - 510) / (580 - 510);
            G = 1;
            B = 0;
        } else if (wl >= 580 && wl < 645) {
            R = 1;
            G = -1 * (wl - 645) / (645 - 580);
            B = 0.0;
        } else if (wl >= 645 && wl <= 780) {
            R = 1;
            G = 0;
            B = 0;
        } else {
            R = 0;
            G = 0;
            B = 0;
        }
 
        // intensty is lower at the edges of the visible spectrum.
        //if (wl > 780 || wl < 380) {
        //    alpha = 0;
        //} else if (wl > 700) {
        //    alpha = (780 - wl) / (780 - 700);
        //} else if (wl < 420) {
        //    alpha = (wl - 380) / (420 - 380);
        //} else {
        //    alpha = 1;
        //}
 
        alpha = 1;
 
        colorSpace = "rgb(" + (R * 100) + "%," + (G * 100) + "%," + (B * 100) + "%)";

        // colorSpace is an array with 5 elements.
        // The first element is the complete code as a string.  
        // Use colorSpace[0] as is to display the desired color.  
        // use the last four elements alone or together to access each of the individual r, g, b and a channels.  
       
        return colorSpace;
       
    }
    
  </script>

</html>
