<!DOCTYPE html>
<html>
<link rel="stylesheet" href="style.css">

<meta http-equiv='cache-control' content='no-cache'> 
<meta http-equiv='expires' content='0'> 
<meta http-equiv='pragma' content='no-cache'>

<script src="scripts.js"></script>

<head>
<style>
* {
  box-sizing:border-box;
}
.column {
  float:left;
  width:50%;
}

.row:after {
  contents: "";
  display: table;
  clear: both;
}

p {
  color:steelblue;
  font-size:14pt;
}

h1 {
  font-size:30pt;
}

h2 {
  font-size:18pt;
}

button {
  background-color:black;
  color:steelblue;
  border: 1px solid tomato;
  padding: 8px;
  font-size: 12pt;
}

button:hover {
  background-color:steelblue;
  color:black;
}

input:hover {
  background-color:steelblue;
  color:black;
}

.column3 {
  float:left;
  width:33%;
}

img:hover {
  width=110%;
}
#canvas {
  border: 1px solid black;
}

</style>

<script src="https://cdn.plot.ly/plotly-2.11.1.min.js"></script>
<script src="plotly-2.11.1.min.js"></script>

</head>

<header>
  <title>Spectroscopy II</title>
  <button class = "button biggerButton" onclick="SpecHome()">Main Menu</button>
</header>

<script>
  function SpecHome() {
    window.open('AstronomicalSpectroscopyII.html','_self');
  }
</script>

<body>

<div class="body">

  <h1>Identifying Spectral Lines</h2> 

  <p style="color:white;">In this first experiment, we'll look at a mock absorption spectrum for the Sun. Press the button below to see a mock spectrum of the Sun. This spectrum does not contain ALL of the Fraunhofer lines, but it does include some of the most conspicuous ones (namely, most of the capital letter lines)</p>

  <p id="display"> </p>
  <p id="finished" style="color:orange;font-size:25pt;"> </p>
  <input type="button" onclick="start()" value="Generate Spectrum" class="center"/>

  <div id="myPlot" style="width:100%" class="center"></div>



</body>

<script> 
    var WLmin = 350;
    var WLmax = 700;
    var WLlength = WLmax - WLmin + 1;

    var wavelengths = new Array(WLlength);
    var yvals = new Array(WLlength);
    var counts = new Array(WLlength); 
    var colors = new Array(WLlength);

    for (var i=0; i<WLlength; ++i) {
      counts[i] = 0;
    };
    for (var i=0; i<WLlength; ++i) {
      wavelengths[i] = WLmin + i;
    };
    for (var i=0; i<WLlength; ++i) {
      yvals[i] = 1;
    };

    var Lines = [393,397,410,423,431,434,438,486,517,527,590,656,686];
    var negative = [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];

    function randomWavelength(min, max) {
      var lambda = parseInt(Math.random() * (max - min) + min);
      if (Lines.includes(lambda)) { 
        lambda = randomWavelength(min,max)
      }
      return lambda;
    }

    function random(min, max) {
      return Math.random() * (max - min) + min;
    }
    
    function WLChecker(WL) {
      let index = wavelengths.indexOf(WL);
      if (Lines.includes(WL)) {
        counts[index] = 0;
      } else {
        counts[index] = 2;
      }
      //return WL;
    }

    function start() {

        	for (var i = 0; i < wavelengths.length; ++i) {
	  var WL = wavelengths[i];
       	  WLChecker(WL);
    	}
      	plot();
    }

    var trace2 = {
      x:wavelengths,
      y:yvals,
      marker: {color:colors},
      type:"bar"
    };
   
    var layout= {
      plot_bgcolor:"black",
      paper_bgcolor:"black",
      yaxis: {
        autorange: true,
        showgrid: false,
        zeroline: false,
        showline: false,
        autotick: true,
        ticks: '',
        showticklabels: false
      },
      bargap:0,
      xaxis: {
        tickcolor: "white",
        tickfont: {color:"white"}
      },
    }
  
    var config = {
      modeBarButtonsToRemove: ['pan2d','lasso2d','select2d','autoScale2d']
    }

    var data = [trace2]

    function plot() {
      for (var i=0; i<WLlength; ++i) {
        colors[i] = wavelengthToColor(wavelengths[i],counts[i]);
      };
      Plotly.newPlot("myPlot", data, layout, config);
    }
    Plotly.newPlot("myPlot", data, layout,config);

    // takes wavelength in nm and returns an rgba value
    // Taken from: https://scienceprimer.com/javascript-code-convert-light-wavelength-color
    function wavelengthToColor(wavelength,count) {
        var r,
            g,
            b,
            alpha,
            colorSpace,
            wl = wavelength,
            gamma = 1;
 
 
        if (wl >= 350 && wl < 440) {
            R = -1 * (wl - 440) / (440 - 350);
            G = 0;
            B = 1;
       } else if (wl >= 440 && wl < 490) {
           R = 0;
           G = (wl - 440) / (490 - 440);
           B = 1;  
        } else if (wl >= 490 && wl < 510) {
            R = 0;
            G = 1;
            B = -1 * (wl - 510) / (510 - 490);
        } else if (wl >= 510 && wl < 580) {
            R = (wl - 510) / (580 - 510);
            G = 1;
            B = 0;
        } else if (wl >= 580 && wl < 645) {
            R = 1;
            G = -1 * (wl - 645) / (645 - 580);
            B = 0.0;
        } else if (wl >= 645 && wl <= 780) {
            R = 1;
            G = 0;
            B = 0;
        } else {
            R = 0;
            G = 0;
            B = 0;
        }
 
        // intensty is lower at the edges of the visible spectrum.
        //if (wl > 780 || wl < 380) {
        //    alpha = 0;
        //} else if (wl > 700) {
        //    alpha = (780 - wl) / (780 - 700);
        //} else if (wl < 420) {
        //    alpha = (wl - 380) / (420 - 380);
        //} else {
        //    alpha = 1;
        //}
 
        alpha = 0 + (count/2);
        colorSpace = "rgba(" + (R * 100) + "%," + (G * 100) + "%," + (B * 100) + "%, " + alpha + ")";
 
        // colorSpace is an array with 5 elements.
        // The first element is the complete code as a string.  
        // Use colorSpace[0] as is to display the desired color.  
        // use the last four elements alone or together to access each of the individual r, g, b and a channels.  
       
        return colorSpace;
       
    }

    function sleep(milliseconds) {
      var start = new Date().getTime();
      for (var i = 0; i < 1e7; i++) {
      if ((new Date().getTime() - start) > milliseconds){
        break;
        }
      }
    }

  </script>

</html>