<!DOCTYPE html>
<html>
<link rel="stylesheet" href="style.css">

<meta http-equiv='cache-control' content='no-cache'> 
<meta http-equiv='expires' content='0'> 
<meta http-equiv='pragma' content='no-cache'>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="scripts.js"></script>

<head>
<style>
* {
  box-sizing:border-box;
}
.column {
  float:left;
  width:50%;
}

.row:after {
  contents: "";
  display: table;
  clear: both;
}

p {
  color:steelblue;
}

button {
  background-color:black;
  color:steelblue;
  border: 1px solid tomato;
  padding: 8px;
}

button:hover {
  background-color:steelblue;
  color:black;
}

input:hover {
  background-color:steelblue;
  color:black;
}

.column3 {
  float:left;
  width:33%;
}

img:hover {
  width=110%;
}
#canvas {
  border: 1px solid black;
}

#myPlot {
  display: flex;
  flex-wrap: wrap;
  width: 100%;
}

</style>

<script src="https://cdn.plot.ly/plotly-2.11.1.min.js"></script>
<script src="plotly-2.11.1.min.js"></script>

</head>

<header>
  <title>Spectroscopy II</title>
  <button class = "button biggerButton" onclick="SpecHome()">Main Menu</button>
</header>

<script>
  function SpecHome() {
    window.open('AstronomicalSpectroscopyII.html','_self');
  }
</script>

<body>

<div class="body">

  <h1>Identifying Spectral Lines</h2> 

  <p style="color:white;">In this first experiment, we'll look at a mock absorption spectrum for the Sun. Press the button below to see a mock spectrum of the Sun. This spectrum does not contain ALL of the Fraunhofer lines, but it does include some of the most conspicuous ones (namely, most of the capital letter lines)</p>

  <p id="display"> </p>
  <p id="finished" style="color:orange;"> </p>
  
  <div class="desktop">
    <input type="button" onclick="start()" value="Generate Spectrum" class="center"/>
    <div id="myPlot" class="center"></div>
    <p id="Cursor"></p>
  </div>
  <div class="mobile">
    <input type="button" onclick="start2()" value="Generate Spectrum" class="center"/>
    <div id="smallPlot" class="center"></div>
    <p id="MobileFriendly"> </p>
    <p id="WLblack"></p>
  </div>

</body>

<script> 
    var WLmin = 350;
    var WLmax = 700;
    var WLlength = WLmax - WLmin + 1;

    var wavelengths = new Array(WLlength);
    var yvals = new Array(WLlength);
    var counts = new Array(WLlength); 
    var colors = new Array(WLlength);

    for (var i=0; i<WLlength; ++i) {
      counts[i] = 0;
    };
    for (var i=0; i<WLlength; ++i) {
      wavelengths[i] = WLmin + i;
    };
    for (var i=0; i<WLlength; ++i) {
      yvals[i] = 1;
    };

    var Lines = [393,397,410,423,431,434,438,486,517,527,590,656,686];
    var negative = [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];

    function randomWavelength(min, max) {
      var lambda = parseInt(Math.random() * (max - min) + min);
      if (Lines.includes(lambda)) { 
        lambda = randomWavelength(min,max)
      }
      return lambda;
    }

    function random(min, max) {
      return Math.random() * (max - min) + min;
    }
    
    function WLChecker(WL,Lines2Omit) {
      let index = wavelengths.indexOf(WL);
      if (Lines2Omit.includes(WL)) {
        counts[index] = 0;
      } else {
        counts[index] = 2;
      }
    }

    function start2() {
	var LinesFull = new Array(Lines.length)
	for (var i = 0; i < Lines.length; ++i) {
	  LinesFull.push(Lines[i] - 1);
	  LinesFull.push(Lines[i]);
	  LinesFull.push(Lines[i] + 1);	  
	}
        	for (var i = 0; i < wavelengths.length; ++i) {
	  var WL = wavelengths[i];
       	  WLChecker(WL,LinesFull);
    	}
      	plot("smallPlot");
	document.getElementById("MobileFriendly").innerHTML = "Since you're on a small device, the wavelengths are listed below:";
	document.getElementById("WLblack").innerHTML = Lines;
    }
   
    function start() {

        	for (var i = 0; i < wavelengths.length; ++i) {
	  var WL = wavelengths[i];
       	  WLChecker(WL,Lines);
    	}
      	plot("myPlot");
	document.getElementById("Cursor").innerHTML = "Use your cursor to find the wavelengths that are omitted <br><br> You can click-and-drag on a desired area to zoom in and double-click to zoom out";
    }

    var trace2 = {
      x:wavelengths,
      y:yvals,
      marker: {color:colors},
      type:"bar"
    };
   
    var layout= {
      plot_bgcolor:"black",
      paper_bgcolor:"black",
      yaxis: {
        autorange: true,
        showgrid: false,
        zeroline: false,
        showline: false,
        autotick: true,
        ticks: '',
        showticklabels: false
      },
      bargap:0,
      xaxis: {
        tickcolor: "white",
        tickfont: {color:"white"}
      },
      showlegend:false
    }
  
    var layout2 = {
      plot_bgcolor:"black",
      paper_bgcolor:"black",
      yaxis: {
        autorange: true,
        showgrid: false,
        zeroline: false,
        showline: false,
        autotick: true,
        ticks: '',
        showticklabels: false
      },
      bargap:0,
      xaxis: {
        tickcolor: "white",
        tickfont: {color:"white"}
      },
      showlegend:false
    }

    var config = {
      modeBarButtonsToRemove: ['pan2d','lasso2d','select2d','autoScale2d','toImage','zoom2d','resetScale2d','zoomIn2d','zoomOut2d'],
      responsive:true,
      displaylogo:false
    }
  
    var config2 = {
      modeBarButtonsToRemove: ['pan2d','lasso2d','select2d','autoScale2d'],
      responsive:true,
      staticPlot:true
    }

    var data = [trace2]

    function plot(which) {
      if (which === "smallPlot") {
        layout = layout2;
        config = config2;
      }
      for (var i=0; i<WLlength; ++i) {
        colors[i] = wavelengthToColor(wavelengths[i],counts[i]);
      };
      Plotly.newPlot(which, data, layout, config);
    }
    Plotly.newPlot(which, data, layout,config);

    // takes wavelength in nm and returns an rgba value
    // Taken from: https://scienceprimer.com/javascript-code-convert-light-wavelength-color
    function wavelengthToColor(wavelength,count) {
        var r,
            g,
            b,
            alpha,
            colorSpace,
            wl = wavelength,
            gamma = 1;
 
 
        if (wl >= 350 && wl < 440) {
            R = -1 * (wl - 440) / (440 - 350);
            G = 0;
            B = 1;
       } else if (wl >= 440 && wl < 490) {
           R = 0;
           G = (wl - 440) / (490 - 440);
           B = 1;  
        } else if (wl >= 490 && wl < 510) {
            R = 0;
            G = 1;
            B = -1 * (wl - 510) / (510 - 490);
        } else if (wl >= 510 && wl < 580) {
            R = (wl - 510) / (580 - 510);
            G = 1;
            B = 0;
        } else if (wl >= 580 && wl < 645) {
            R = 1;
            G = -1 * (wl - 645) / (645 - 580);
            B = 0.0;
        } else if (wl >= 645 && wl <= 780) {
            R = 1;
            G = 0;
            B = 0;
        } else {
            R = 0;
            G = 0;
            B = 0;
        }
 
        // intensty is lower at the edges of the visible spectrum.
        //if (wl > 780 || wl < 380) {
        //    alpha = 0;
        //} else if (wl > 700) {
        //    alpha = (780 - wl) / (780 - 700);
        //} else if (wl < 420) {
        //    alpha = (wl - 380) / (420 - 380);
        //} else {
        //    alpha = 1;
        //}
 
        alpha = 0 + (count/2);
        colorSpace = "rgba(" + (R * 100) + "%," + (G * 100) + "%," + (B * 100) + "%, " + alpha + ")";
 
        // colorSpace is an array with 5 elements.
        // The first element is the complete code as a string.  
        // Use colorSpace[0] as is to display the desired color.  
        // use the last four elements alone or together to access each of the individual r, g, b and a channels.  
       
        return colorSpace;
       
    }

    function sleep(milliseconds) {
      var start = new Date().getTime();
      for (var i = 0; i < 1e7; i++) {
      if ((new Date().getTime() - start) > milliseconds){
        break;
        }
      }
    }

  </script>

</html>